services:
  # ç®€å•æµ‹è¯•ç‰ˆæœ¬ - åªå¯åŠ¨åº”ç”¨ï¼Œä¸å¯åŠ¨Ollama
  perspective-kb-test:
    container_name: perspective-kb-test
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      # ä½¿ç”¨æœ¬åœ°Ollamaï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
      - PKB_OLLAMA_HOST=http://host.docker.internal:11434
      - PKB_EMBEDDING_MODEL=mitoza/Qwen3-Embedding-0.6B:latest
      - PKB_MILVUS_USE_SERVER=false
      - PKB_DB_PATH=./milvus_lite.db
      - PKB_LOG_LEVEL=DEBUG
    volumes:
      - ./data:/app/data:ro
      - ./log:/app/log
    ports:
      - "8001:8000"
    networks:
      - test-network
    command: >
      sh -c "
        echo 'ğŸš€ æµ‹è¯•æ¨¡å¼å¯åŠ¨...' &&
        echo 'æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...' &&
        python -m perspective_kb.cli status &&
        echo 'ä¿æŒè¿è¡ŒçŠ¶æ€...' &&
        sleep 3600
      "

networks:
  test-network:
    driver: bridge
